# Community-assembly
Working towards a general, trait-based, multi-trophic-level, quantitative community assembly modelling framework.

V2 (Oct 2025)
Overview. Our framework quantifies the core conceptual model of community assembly, which posits that the three processes of environmental filtering, biotic interactions, and dispersal limitation determine which species from the regional “species pool” can establish in a local community—and how abundant they are there. It does so by integrating sub-models that describe how phenotypic traits influence environmental tolerance (“trait–environment relationships”), how dispersal limitation is fundamentally probabilistic but still shaped by dispersal-related traits (e.g., seed dispersal syndrome in plants, wing loading ratio in birds, saltwater tolerance across taxa), and how species associations represent biotic filtering. 
Empirically incorporating species associations has long been difficult. Correlations in abundance can arise from shared or opposing responses to unmeasured environmental conditions (e.g., microclimate) and therefore cannot automatically be interpreted as true interactions. We address this in two ways. First, we apply causal modeling to restrict the set of associations to those that are plausibly driven by actual biotic interactions. Second, we use controlled field experiments to establish causal influences among distinct ecological guilds at local spatial scales. 
An overview of the modeling framework is shown in Figure 1, and preliminary models are available at [GitHub link]. These models have already been successfully fit to data from the NSF NEON program, but key refinements remain necessary. In particular, we currently have separate sub-models for landscape-scale assembly and species associations, which must now be integrated and combined with the stochastic dispersal limitation components.	

Model structure. Communities are represented as a series of single-species equations linked into Structural Equation Models (SEMs). Specifically, our SEMs will be formulated as Simultaneous Equation Models (common in econometrics) that, unlike traditional SEMs, allow for feedbacks among species; in our models, for example, species A and B can reciprocally affect one another. Each equation describes the abundance of species i (N_i) as a function of three key components:
N_i∼("trait"×"environment")+(N_1+N_2+⋯+N_s)+("dispersal limitation term"),
where the dispersal term is fundamentally stochastic but influenced by dispersal-related traits.
As an example, consider a community with three tree species, two phenotypic traits, and two environmental variables where trait-environment regressions reveal that tree height is positively related to mean annual precipitation (P_i) and specific leaf area (SLA) is associated with mean annual temperature (T_i). The abundance of species 1 across sites (which vary in precipitation and temperature) can then be predicted by: (i) the environmental influences at each site, given the invariant traits of species 1; (ii) the estimated abundances of the other species (N₂ and N₃), which are themselves determined by their traits and environments; and (iii) a dispersal limitation term that is stochastic but influenced by a dispersal-related trait such as seed size. For s species and n sites, let N_isrepresent the abundance (or density) of species s at site i. Using a generalized linear (or mixed) model with a log link, the linear predictor for each species includes Trait × Environment: species-invariant traits (T_s) interacting with site environments (E_i); Biotic feedbacks: the abundances of other species at the same site; Dispersal limitation: a stochastic site effect whose scale or mean depends on dispersal-related traits (e.g., seed size). The equations describing the system are then:
■(η_i1&=α_1+θ_(H,P) H_1 P_i+θ_(S,T) S_1 T_i+β_12 N_i2+β_13 N_i3+U_i1,@η_i2&=α_2+θ_(H,P) H_2 P_i+θ_(S,T) S_2 T_i+β_21 N_i1+β_23 N_i3+U_i2,@η_i3&=α_3+θ_(H,P) H_3 P_i+θ_(S,T) S_3 T_i+β_31 N_i1+β_32 N_i2+U_i3,@N_is&∼"NegBinom" (μ_is,ϕ_s),log⁡μ_is=η_is.)
where θ_(H,P) and θ_(S,T) are global slopes describing how strongly height × precipitation and SLA × temperature, respectively, affect abundance; β_sr are species–species interaction or association coefficients (the effect of species r on s); U_isis the dispersal limitation term modeled as a trait-scaled random effect:
U_is∼N(0,σ_s^2),log⁡σ_s=δ_0+δ_1 log⁡(〖"seed size" 〗_s).
Here, dispersal ability is assumed to negatively related to seed size, such that species with small seeds are expected to have smaller site-to-site variance (negative δ_1) because they reach more sites.
	Finally, we include a sub-model to assess how species composition influences a key ecological function, ecosystem carbon storage. Once tree species compositions and abundances have been predicted, we can estimate total aboveground biomass density by multiplying abundance by species-specific median masses, correcting for the proportion of carbon in the biomass, and summing across species. Median masses are calculated by using median height (see “Trait campaign,” below) to estimate tree volume, assuming a conical bole shape to account for taper, and then multiplying volume by wood density to obtain mass. We then assume that wood is ~47% carbon to convert total biomass to carbon content.

Avoiding over-parameterization and ensuring identifiability. This framework could easily generate far too many covariates within each species equation, risking overfitting or non-identifiability. We will circumvent this in several ways. First, we will use ecological knowledge to eliminate many implausible parameters. For example, species will only be allowed to compete with other species that are both trait-similar and relatively common. Because the majority of species in all communities are rare, this excludes a large fraction of possible competition coefficients. Similarly, we will restrict which traits can interact with which environmental variables—for instance, leaf osmotic potential (a measure of drought tolerance) will interact with rainfall seasonality but not with mean annual temperature or soil C:N ratio. 
Second, we will constrain most parameters based on ecological reasoning to enhance identifiability. Species–species coefficients will be constrained to be negative, with prior means set by pairwise trait distances; likewise, trait–environment interactions will be constrained to ecologically plausible directions (e.g., drought tolerance positively related to rainfall seasonality). 
Third, rather than solving one large, analytically intractable SEM, we will run a very large number of simulations, each involving smaller, manageable equations. For each of up to one million model iterations, equation parameters will be randomly sampled, and the importance of coefficients tracked across iterations. This will identify a small set of influential predictors that compose the final model. Many mature sciences, from quantum mechanics to meteorology, rely on numerical simulations rather than closed-form analytical solutions. Ecology can adopt a similar approach and often must do so—as ecologist Daniel Schindler observed, “Ecology is not rocket science; it is way more complicated.” 
Fourth, we may use random forest models in an initial analytical phase to identify important variables. Random forests are a machine learning approach that is highly robust to overfitting and provides variable importance scores and partial dependence plots, which will help identify the most influential predictors and the shapes of their relationships (e.g., first- vs. second-order polynomials) for inclusion in the subsequent SEM statistical models. 
Finally, we can employ selected instrumental variables that influence specific model components but are exogenous to others. For instance, kernel-weighted adult proximity can serve as a measure of seed rain influencing dispersal limitation, improving identifiability of the stochastic dispersal component. Together, these strategies will ensure that our SEMs remain computationally tractable, ecologically interpretable, and statistically identifiable, while maintaining the mechanistic richness needed to capture the processes underlying community assembly.

Comparison to existing approaches. Powerful modeling frameworks such as joint species distribution models address part of what we propose here, in that they can predict which species occur where as a function of the environment and, to a limited degree, other species. However, these models do not include other species’ observed abundances explicitly as predictors; instead, they use residual correlations or latent factors to capture associations. In contrast, our approach explicitly regresses each species’ abundance on the others at the same site (the B matrix). This makes the system simultaneous; e.g., N_1 could depend on N_2 and N_3, N_2 on N_1and N_3, and so on. This structure provides a directly interpretable interaction network akin to Lotka–Volterra models. 
There are two additional advantages that make our framework a truly general model of community assembly. First, we make no a priori assumptions about local community composition—that is, which species occur at a given site. Instead, the model estimates this directly, consistent with the central goal of community assembly theory to understand how the regional species pool is filtered into local communities. (This also distinguishes our approach from existing single-trophic-level assembly models such as TraitSpace and CATS, which estimate relative abundance based on a known composition of local communities.) Second, traits are not merely included as predictors in our models, they form the backbone of the entire framework. In other words, we are not estimating which particular species occur at a given site, but rather which types of species—that is, which combinations of traits—are predicted to occur there. This trait-based generalization, in our view, is the only way to make community assembly models truly general and predictive across systems and scales.

Spatial scale. The proposed work spans three spatial scales. Regional scale assesses the occurrence and average abundance of species across the set of 50 ha ForestGEO plots within each region. The hypothesis is that occurrence and abundance at this scale are primarily driven by interactions between traits and four macroclimatic factors. Specifically we will use existing GIS products to measure (i) rainfall seasonality (correlated with mean annual rainfall, but a more direct metric of potential drought stress), (ii) mean annual temperature, and (iii) 95th percentile wind speeds (a metric of susceptibility to blowdown). These climatic variables will be combined with (iv) on-the-ground measurements of soil C:N ratio, an important indicator of nutrient availability and decomposition rates, obtained either from the literature or through direct collaboration with plot principal investigators. 
Next, landscape scale assesses the occurrence and abundance of species across 20 × 20 m subplots within the ForestGEO plots. The hypothesis is that, because macroclimatic filtering has already occurred, variation at this scale is mainly driven by interactions between traits and topographic position (i.e., ridgetop vs. midslope vs. valley floor). 
Finally, local scale assesses the occurrence and abundance of species within 5 × 5 m experimental plots (see “Experiments”, below). At this fine scale, the prediction is that occurrence and abundance are primarily driven by species interactions. 

Application to field data. Operationalizing these models requires applying them to complex systems with numerous interacting components. There are no ecosystems more complex than tropical rainforests, so we will use three well-studied rainforest sites with long-term data: Barro Colorado Island (BCI; Panama), Danum Valley (Malaysian Borneo), and Yasuní (Ecuador). These models demand substantial data, and in our case there are two primary requirements: phenotypic trait data and controlled experiments (both described below). 
While our long-term goal is to model the entire ecosystem, the complexity and diversity of tropical forests make this a stepwise process. We begin by focusing on a set of interacting ecological guilds that previous research has shown to be critical to forest function. First are the trees themselves, which form the structural basis of the forest. Our work will use three ForestGEO plots with long-term demographic data on both adult trees and seedlings. Next are the vertebrates that influence tree regeneration through seed dispersal, seed predation, and seedling herbivory. Then come the insects that destroy seeds and prey on seedlings. These, in turn, are regulated by vertebrate insectivores, and we focus particularly on birds, as research indicates they may play a more important role in these systems than mammalian insectivores. Finally, we include mycorrhizal fungi, which affect trees through nutrient acquisition and protection. Forest trees form two general types of mycorrhizal associations: ectomycorrhizal (EM) fungi, which can protect against host-specific fungal pathogens such that conspecific density may actually benefit trees, and arbuscular mycorrhizal (AM) fungi, which can facilitate signaling among plants about insect attacks but for which conspecific density is typically detrimental.

Trait campaign. Phenotypic traits are required to fit both the trait–environment sub-models and the trait-informed dispersal models, allowing us to assess how functional traits mediate species distributions, community structure, and ecosystem processes. Such traits are generally available for birds and mammals through databases such as EltonTraits, PanTHERIA, and others. For our purposes, mycorrhizal traits will simply be classified as either AM or EM, information that is available from the literature. 
The primary trait data that still need to be collected are plant traits. To complement our community assembly analyses, we will incorporate key plant functional traits across the three ForestGEO sites to assess their role in shaping biodiversity patterns and ecosystem functions. We will focus on five key traits that together capture complementary aspects of tree life history. (1) Tree height is important for light competition, determining the dispersal kernels of abiotically dispersed seeds, and influencing susceptibility to wind- and lightning-induced mortality, among other factors. Height will be estimated from publicly available diameter data from the ForestGEO plots using species-specific diameter–height allometric equations derived from ForestGEO inventory data. (2) Specific leaf area (SLA) is a widely used trait that integrates many aspects of a tree’s life history, including photosynthetic capacity, growth rate, and leaf lifespan. SLA data are available for many species in global plant trait databases such as TRY and BIEN. (3) Wood density is an important metric of mechanical strength, growth–mortality trade-offs, and carbon storage capacity (necessary for our “ecological function” sub-model). These data will be extracted from global datasets and cross-checked with local field measurements where available. (4) Leaf osmotic potential is a powerful indicator of drought tolerance, providing critical insight into species’ water-use strategies. It can be measured in the field following methodology developed by co-PI Sack. (5) Seed size, in combination with dispersal syndrome, is a useful metric of dispersal life history and dispersal distance, and will be incorporated into the stochastic dispersal limitation term of the SEM equations. This information is available for many species from global plant trait databases and the primary literature.
Part of this project involves a trait campaign to collect missing data in the field and fill existing gaps. Leaf osmotic potential has been assessed for dominant species at Yasuní, but we are still missing data on this trait from Barro BCI and Danum Valley, as well as SLA, wood density, and seed size data for roughly 250 dominant species across all three sites. We will not be able to obtain a complete set of trait measurements for all species at all sites, as many species are extremely rare. For these, we will use genus-level averaging to impute trait values, since these traits are known to be highly phylogenetically conserved at the genus level.

Experiments. Data on several key interactions are missing from the literature but are needed for incorporation into our local-scale community assembly models to predict community structure and function. Plant-eating insects can damage and destroy tree seedlings, but we have limited understanding of the degree to which forest dynamics and species composition are affected by such herbivory. Likewise, insectivores (particularly birds) can help control populations of herbivorous insects, with resulting trophic cascades that influence the regeneration dynamics of tropical trees. However, direct evidence for such effects in tropical forests remains scarce. Finally, mycorrhizal fungal associations can strongly affect tree populations, including via mediating the impacts of herbivory. We therefore propose a simple, standardized experiment to assess the influence of these guilds on tree seedling dynamics to quantify the influence of insects, insect-eating birds, and mycorrhizae on the survival and growth of a set of dominant, shade-tolerant tree seedlings. The experiment will be conducted near the 50-ha ForestGEO plots in the three study areas, focusing on dominant seedling taxa at each site. Most experimental treatments have already begun at Danum Valley. We will add one additional treatment (mycorrhizal network exclusion) and expand the experiment to the other two ForestGEO sites. At Danum, the dominant taxa include Shorea (three species), Parashorea (two species), Koompassia (one species), and Pterospermum (X species).
Each sampling plot will be a 4 × 4 m square (16 m²) surrounded by a 5 × 5 m metal wire fence, providing a 0.5 m buffer strip around the edge of the sampling area. The wire fences are designed to exclude terrestrial vertebrate herbivores, following Granados et al. (2018). They will be 1.5 m tall with 3 cm mesh, secured at the corners and midpoints with metal T-post stakes. The top of each fence will be reinforced with barbed wire to deter elephants (Danum only) and lined with solid metal flashing to prevent animals from climbing over. Within each sampling plot, naturally occurring seedlings (defined as stems with a minimum height of 20 cm and a maximum DBH of 1 cm) of the target taxa will be marked with numbered aluminum tags. We will measure the height of each seedling at the start of sampling and resurvey the plots quarterly to record survival and growth, with new tags deployed on newly germinated seedlings of the target taxa as needed. At plot establishment and each survey, we will also record the number and height of all seedlings in the plot—not just those of the target taxa—to account for the influence of heterospecific density on survival and growth. Finally, we will record canopy cover and soil nutrients (C:N:P) at each survey, as light and nutrient availability can mediate herbivory and the influence of mycorrhizae on plants. 
Each sampling plot will be divided into four 2 × 2 m subplots, each randomly assigned to a treatment. The treatments are as follows: (1) insecticide—seedlings will be sprayed with malathion (2.5 mL of 57% w/w per 1 L of water) every two weeks; (2) bird exclusion—plots will be covered with fruit-tree netting (sourced from garden/agricultural supply stores) to prevent bird access; (3) insecticide + bird exclusion—plots will receive both malathion spraying and fruit-tree netting; (4) control—no insecticide or netting. A random subset of seedlings within each plot will be assigned to treatment (5) mycorrhizae exclusion—seedlings will be transplanted in-place into nylon bags with 0.45 µm mesh, which allows exchange of water, nutrients, and single-celled pathogenic fungi with the surrounding soil but excludes hyphae, preventing connection to mycorrhizal networks. (As a methodological control, other monitored seedlings will be transplanted into nylon mesh bags with holes to allow fungal hyphae.) To control for potential effects of spraying alone, seedlings in treatments 2 and 4 will be sprayed with the same volume of water as those in treatments 1 and 3, but without malathion. Although the insecticide will also reduce predatory arthropods, previous research suggests that their influence on seedling dynamics in similar systems is minor compared to that of vertebrate predators (Sam et al. 2022). Each treatment will be replicated 15 times (one subplot per plot × three plots per sampling location × five sampling locations). 


V1 (Aug 2025)
OVERVIEW
A central theme of community ecology is understanding how many, and which, species from the regional species pool occur in any given local community. The dominant conceptual model of such “community assembly” holds that three processes—environmental filtering, biotic interactions, and dispersal limitation—govern this sorting. Yet this heuristic has not been expressed in a general, quantitative, and multi trophic way, limiting predictive ecology. Our project addresses this gap by using environmental and trait data to predict species richness, composition, and abundance across multiple trophic levels. 

DATA USED IN THE CURRENT MODEL DEVELOPMENT
We are currently developing the model using NEON data on rodents (122 species) and their avian (19 species) and mammalian (3 species of Mustela) predators at sites across North America. We use species trait data from EltonTraits () (with some “pseudo-traits” described in the “Note” below). Environmental data comes from NEON. Sampling units are “siteHabitats”, or distinct habitat types within study locations. For example, the NEON site “HARV” has several distinct sampling units including “HARV_evergreenForest” and “HARV_woodyWetlands”. The number of siteHabitats is 76 and 75 for prey and predators, respectively. 

BACKGROUND
Previous quantitative frameworks have provided important advances. In particular, models such as CATS () and TraitSpace () leverage species traits to estimate relative abundances within local communities. These approaches, however, do not explicitly address which species are present to begin with, and they generally target a single trophic level. Our goal is to extend these ideas into a modular, multi trophic framework that can both estimate a site’s overall capacity for individuals and allocate that capacity among species according to trait–environment relationships. We emphasize that our current implementation chiefly targets environmental filtering. Biotic interactions are incorporated only implicitly via trait–environment terms, and dispersal limitation is not yet modeled.

APPROACH
1)	Estimate environmental carrying capacities (ECCs) across siteHabitats. The goal here is to predict the total number of individuals across all species at each siteHabitat. This aligns with theory about productivity-limited diversity, such as the More Individuals Hypothesis (). A Bayesian regression (“brm()”) model with natural spline terms for environmental covariates is used. The best performing prey ECC model in the current version is a Gamma family with log link, with spline terms for minimum temperature, temperature variability, elevation, total precipitation, and snow water equivalent. The predator ECC model includes prey availability (the total number of “small”, “medium”, and “large”-bodied individuals) as predictors. The best current predator ECC is also a Gamma/log model with spline terms for prey abundance (especially medium & large size classes) and minimum temperature. Predicted ECCs are constrained to the observed range across sites to avoid unrealistic extrapolation, though currently these constraints are not needed (estimated ECCs are already within the observed range).
2)	Estimate the mean relative abundance of each species at each site via trait–environment models. The goal is to predict each species’ local abundance as a function of traits, environments, and their interactions. The modelling begins with a global log normal/identity model with a wide set of EltonTraits style traits (diet categories, body mass, climbing, nocturnality) and pseudo traits representing environmental tolerances (min/max ambient temperature; min/max annual precipitation across the species’ geographical ranges) and environmental covariates (elevation, maximum annual temperature, precipitation and its square, shortwave radiation, tree & shrub cover). Two waves of subset selection retain terms with non negligible posteriors, keeping associated main effects when interactions remain. The predator models are analogous, with predator traits (foraging stratum indicators, body mass, nocturnality) and the same set of environmental covariates. Subset selection yields a more compact top model with terms such as max annual precipitation × elevation and precipitation² interactions. This gives relative abundances across species that sum to 1 within a given siteHabitat.
3)	Convert to absolute abundances. Within each siteHabitat, we multiply the estimated relative abundances (vector with one row per species) by the estimated ECC for that site (scalar). This gives a vector of absolute abundances across species that sums to the estimated ECC for that siteHabitat. 
4)	Calculate species richness at each siteHabitat as the count of all species with estimated abundance > 0. 

NOTE: TRAINING WHEELS USED TO CONSTRAIN THE MODELS (FOR NOW).
•	Pseudo traits for tolerances. Because EltonTraits alone did not provide sufficient filtering (all species were predicted to occur everywhere), we added species level climate tolerance envelopes as proxies for actual thermal and moisture tolerance traits. These were constructed by using species range maps and continent-wide climate data to extract the min & max temperatures and precipitations within each species range. Ideally these can be replaced by empirical physiological data, e.g. from GlobTherm once coverage improves.
•	Parameter range bounding. ECC and abundance predictions are constrained post hoc to be within the observed ranges to reduce pathological extrapolation.
•	Initial abundance estimates below a user-defined value (“abundCutoff”) are set to 0. Currently abundance cutoffs for prey and predators are 5 and 1 individuals, respectively. 
•	Estimated abundance values that exceed the maximum observed abundance are capped at that maximum.

EVALUATION METRICS
•	ECC: correlation between observed and predicted values; calculated separately for prey and predators. 
•	Composition & abundance: Mean (across siteHabitats) Spearman ρ between observed and predicted relative abundances across species; calculated separately for prey and predators.
•	Species richness: correlation between observed and predicted values; calculated separately for prey and predators.

